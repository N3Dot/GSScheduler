<UpgradeButton@MDIconButton>:
    icon: "plus-circle-outline"
    style: "standard"
    theme_font_size: "Custom"
    font_size: "18sp"
    pos_hint: {"center_y": 0.58}
    size_hint: None, None
    size: "24dp", "16dp"
    theme_icon_color: "Custom"
    icon_color: "white"

<CharacterCard>:
    md_bg_color: self.theme_cls.primaryColor
    orientation: 'horizontal'
    size_hint_y: None
    height: "275dp"
    padding: "16dp"
    spacing: "20dp"
    # --- Character Portrait ---
    MDCard:
        style: "filled"
        radius: [10, ]
        padding: "8dp"
        size_hint_x: 0.45
        on_release: app.on_click_character()
        FitImage:
            source: root.imagePath
            radius: [10, ]
    # --- Character Stats ---
    MDScrollView:
        do_scroll_x: False
        size_hint_x: 0.55
        MDBoxLayout:
            orientation: 'vertical'
            size_hint_y: None
            adaptive_height: True
            spacing: "9dp"
            MDLabel:
                text: root.name
                bold: True
                font_style: "Title"
                theme_text_color: "Custom"
                text_color: self.theme_cls.primaryContainerColor
                adaptive_height: True
            MDLabel:
                text: root.title
                font_style: "Label"
                role: "large"
                theme_text_color: "Custom"
                text_color: self.theme_cls.primaryContainerColor
                adaptive_height: True
            
            MDDivider:
            
            MDBoxLayout:
                orientation: "horizontal"
                adaptive_height: True
                padding: 0, "6dp"
                MDLabel:
                    text: "Cấp:"
                    bold: True
                    theme_text_color: "Custom"
                    text_color: self.theme_cls.primaryContainerColor
                MDLabel:
                    text: str(root.level)
                    halign: "right"
                    theme_text_color: "Custom"
                    text_color: self.theme_cls.primaryContainerColor
            
            MDBoxLayout:
                orientation: "horizontal"
                adaptive_height: True
                BarWide:
                    statName: "HP"
                    current: root.hpCurrent
                    max: root.hpMax
                    isLight: True
                UpgradeButton:
                    opacity: 1 if (root.available_points > 0) else 0
                    disabled: 0 if (root.available_points > 0) else 1
                    on_release: app.handle_attribute_upgrade("max_hp")
            
            BarWide:
                statName: "XP"
                current: root.xpCurrent
                max: root.xpMax
                isLight: True
            
            MDDivider:

            MDBoxLayout:
                orientation: "horizontal"
                adaptive_height: True
                MDLabel:
                    text: "Khéo Tay:"
                    bold: True
                    theme_text_color: "Custom"
                    text_color: self.theme_cls.primaryContainerColor
                MDLabel:
                    text: str(root.dex)
                    halign: "right"
                    theme_text_color: "Custom"
                    text_color: self.theme_cls.primaryContainerColor
                UpgradeButton:
                    opacity: 1 if (root.available_points > 0) else 0
                    disabled: 0 if (root.available_points > 0) else 1
                    on_release: app.handle_attribute_upgrade("dex")
            
            MDBoxLayout:
                orientation: "horizontal"
                adaptive_height: True
                MDLabel:
                    text: "Trí Tuệ:"
                    bold: True
                    theme_text_color: "Custom"
                    text_color: self.theme_cls.primaryContainerColor
                MDLabel:
                    text: str(root.int)
                    halign: "right"
                    theme_text_color: "Custom"
                    text_color: self.theme_cls.primaryContainerColor
                UpgradeButton:
                    opacity: 1 if (root.available_points > 0) else 0
                    disabled: 0 if (root.available_points > 0) else 1
                    on_release: app.handle_attribute_upgrade("int")
            
            MDBoxLayout:
                orientation: "horizontal"
                adaptive_height: True
                MDLabel:
                    text: "May Mắn:"
                    bold: True
                    theme_text_color: "Custom"
                    text_color: self.theme_cls.primaryContainerColor
                MDLabel:
                    text: str(root.luk)
                    halign: "right"
                    theme_text_color: "Custom"
                    text_color: self.theme_cls.primaryContainerColor
                UpgradeButton:
                    opacity: 1 if (root.available_points > 0) else 0
                    disabled: 0 if (root.available_points > 0) else 1
                    on_release: app.handle_attribute_upgrade("luk")
            
            MDBoxLayout:
                orientation: "horizontal"
                adaptive_height: True
                padding: 0, "6dp"
                MDLabel:
                    id: points_hint
                    text: f"Bạn có thể nâng cấp {root.available_points} thuộc tính!" if (root.available_points > 0) else ""
                    font_style: "Label"
                    italic: True
                    theme_text_color: "Custom"
                    text_color: self.theme_cls.primaryContainerColor